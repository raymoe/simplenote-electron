(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{1135:function(e,t,n){"use strict";n.r(t);var o=n(0),r=n.n(o),a=n(1),i=n.n(a),s=n(13),c=n(14),u=n(1079),l=n(76),f=n(83),p=n.n(f),d=function(e){var t=e.openShareDialog;return r.a.createElement("div",{className:"tag-email-tooltip"},r.a.createElement("div",{className:"tag-email-tooltip__arrow"}),r.a.createElement("div",{className:"tag-email-tooltip__inside"},"Collaboration has moved. Press the Share icon in the toolbar to access the ",r.a.createElement("a",{href:"#",onClick:t},"Collaborate screen"),"."))};d.propTypes={openShareDialog:i.a.func.isRequired};var h=Object(s.b)(null,function(e){return{openShareDialog:function(){return e(c.a.actionCreators.showDialog({dialog:p.a.SHARE}))}}})(d),g=n(4),b=n.n(g),m=n(2),v=function(e){var t=e.onSelect,n=void 0===t?m.noop:t,o=e.selected,a=e.tag;return r.a.createElement("div",{className:b()("tag-chip",{selected:o}),"data-tag-name":a,onClick:n},a)};v.displayName="TagChip";var y=v;function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function E(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function S(e){return(S=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function C(e,t){return(C=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function O(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var F=9,k=13,j=39,N=function(e){return function(t){return t.trim().toLowerCase().startsWith(e.trim().toLowerCase())}},P=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return T(O(O(n=function(e,t){return!t||"object"!==w(t)&&"function"!=typeof t?O(e):t}(this,(e=S(t)).call.apply(e,[this].concat(r))))),"state",{isComposing:!1}),T(O(O(n)),"completeSuggestion",function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m.identity,t=n.props,o=t.onChange,r=t.tagNames,a=t.value;if(a.length){var i=r.find(N(a));i&&o(i,function(){e(i),n.focusInput()})}}),T(O(O(n)),"focusInput",function(){if(n.inputField){var e=n.inputField;e.focus();var t=document.createRange();t.selectNodeContents(e),t.collapse(!1);var o=window.getSelection();o.removeAllRanges(),o.addRange(t)}}),T(O(O(n)),"hasFocus",function(){return document.activeElement===n.inputField}),T(O(O(n)),"interceptKeys",function(e){var t;return Object(m.invoke)((T(t={},k,n.submitTag),T(t,F,n.interceptTabPress),T(t,j,n.interceptRightArrow),t),e.keyCode,e)}),T(O(O(n)),"interceptRightArrow",function(e){var t=n.props.value;window.getSelection().getRangeAt(0).endOffset===t.length&&(n.completeSuggestion(),e.preventDefault(),e.stopPropagation())}),T(O(O(n)),"interceptTabPress",function(e){n.completeSuggestion(n.submitTag),e.preventDefault(),e.stopPropagation()}),T(O(O(n)),"onInputMutation",function(e){e.forEach(function(e){var t=Object(m.get)(e,"target.data","");"childList"===e.type&&e.addedNodes.length&&(t=Object(m.get)(e,"target.innerText","")),n.onInput(t)})}),T(O(O(n)),"onInput",function(e){n.state.isComposing||(e.endsWith(",")&&e.trim().length?n.props.onSelect(e.slice(0,-1).trim()):n.props.onChange(e.trim(),n.focusInput))}),T(O(O(n)),"onCompositionEnd",function(e){var t=e.target.textContent;n.setState({isComposing:!1},function(){return n.onInput(t)})}),T(O(O(n)),"removePastedFormatting",function(e){var t;Object(m.get)(e,"clipboardData.getData")?t=e.clipboardData.getData("text/plain"):Object(m.get)(window,"clipboardData.getData")&&(t=window.clipboardData.getData("Text")),n.onInput(t),e.preventDefault(),e.stopPropagation()}),T(O(O(n)),"storeInput",function(e){n.inputField=e,n.props.inputRef(e),Object(m.invoke)(O(O(n)),"inputField.addEventListener","paste",n.removePastedFormatting,!1)}),T(O(O(n)),"submitTag",function(e){var t=n.props,o=t.onSelect,r=t.value;r.trim().length&&o(r.trim()),Object(m.invoke)(e,"preventDefault"),Object(m.invoke)(e,"stopPropagation")}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&C(e,t)}(t,o["Component"]),function(e,t,n){t&&E(e.prototype,t),n&&E(e,n)}(t,[{key:"componentDidMount",value:function(){this.props.storeFocusInput(this.focusInput),this.props.storeHasFocus(this.hasFocus),this.inputObserver=new MutationObserver(this.onInputMutation),this.inputObserver.observe(this.inputField,{characterData:!0,childList:!0,subtree:!0})}},{key:"componentWillUnmount",value:function(){Object(m.invoke)(this,"inputField.removeEventListener","paste",this.removePastedFormatting,!1),this.inputObserver.disconnect()}},{key:"render",value:function(){var e=this,t=this.props,n=t.value,o=t.tagNames,a=n.length&&o.find(N(n)),i=""===n&&!this.state.isComposing;return r.a.createElement("div",{className:"tag-input",onClick:this.focusInput},i&&r.a.createElement("span",{"aria-hidden":!0,className:"tag-input__placeholder"},"Add a tag…"),r.a.createElement("div",{"aria-label":"Add a tag…",ref:this.storeInput,className:"tag-input__entry",contentEditable:"true",onCompositionStart:function(){return e.setState({isComposing:!0})},onCompositionEnd:this.onCompositionEnd,onKeyDown:this.interceptKeys,spellCheck:!1,suppressContentEditableWarning:!0},n),r.a.createElement("div",{className:"tag-input__suggestion",disabled:!0,type:"text"},a?a.substring(n.length):""))}}]),t}();T(P,"displayName","TagInput"),T(P,"propTypes",{inputRef:i.a.func,onChange:i.a.func,onSelect:i.a.func,storeFocusInput:i.a.func,storeHasFocus:i.a.func,tagNames:i.a.arrayOf(i.a.string).isRequired,value:i.a.string.isRequired}),T(P,"defaultProps",{inputRef:m.identity,onChange:m.identity,onSelect:m.identity,storeFocusInput:m.noop,storeHasFocus:m.noop});var R=P,_=n(7),H=n.n(_);function I(e){return(I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function M(e){return(M=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function q(e,t){return(q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function x(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var A=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return L(x(x(n=function(e,t){return!t||"object"!==I(t)&&"function"!=typeof t?x(e):t}(this,(e=M(t)).call.apply(e,[this].concat(r))))),"state",{selectedTag:"",tagInput:""}),L(x(x(n)),"addTag",function(e){var t=n.props,o=t.allTags,r=t.tags,a=e.trim().replace(/\s+/g,",").split(",");a.some(l.a)&&n.showEmailTooltip();var i=Object(m.union)(r,Object(m.intersectionBy)(o,a,function(e){return e.toLocaleLowerCase()}),Object(m.differenceBy)(a,o,function(e){return e.toLocaleLowerCase()}));n.props.onUpdateNoteTags(i),n.storeTagInput(""),Object(m.invoke)(x(x(n)),"tagInput.focus"),H.a.tracks.recordEvent("editor_tag_added")}),L(x(x(n)),"hasSelection",function(){return n.state.selectedTag&&!!n.state.selectedTag.length}),L(x(x(n)),"deleteTag",function(e){var t=n.props,o=t.onUpdateNoteTags,r=t.tags,a=n.state.selectedTag;o(Object(m.differenceBy)(r,[e],function(e){return e.toLocaleLowerCase()})),a===e&&n.setState({selectedTag:""},function(){Object(m.invoke)(x(x(n)),"tagInput.focus")}),H.a.tracks.recordEvent("editor_tag_removed")}),L(x(x(n)),"deleteSelection",function(){n.hasSelection()&&n.deleteTag(n.state.selectedTag)}),L(x(x(n)),"hideEmailTooltip",function(){return n.setState({showEmailTooltip:!1})}),L(x(x(n)),"hasFocus",function(){return n.inputHasFocus&&n.inputHasFocus()}),L(x(x(n)),"focusTagField",function(){return n.focusInput&&n.focusInput()}),L(x(x(n)),"interceptKeys",function(e){8===e.which&&(n.hasSelection()&&n.deleteSelection(),""===n.state.tagInput&&(n.selectLastTag(),e.preventDefault()))}),L(x(x(n)),"selectLastTag",function(){return n.setState({selectedTag:n.props.tags.slice(-1).shift()})}),L(x(x(n)),"selectTag",function(e){var t=e.target.dataset.tagName;e.preventDefault(),e.stopPropagation(),n.deleteTag(t)}),L(x(x(n)),"showEmailTooltip",function(){n.setState({showEmailTooltip:!0}),setTimeout(function(){return n.setState({showEmailTooltip:!1})},5e3)}),L(x(x(n)),"onKeyDown",function(e){return n.state.showEmailTooltip&&n.hideEmailTooltip(),n.interceptKeys(e)}),L(x(x(n)),"storeFocusInput",function(e){return n.focusInput=e}),L(x(x(n)),"storeHasFocus",function(e){return n.inputHasFocus=e}),L(x(x(n)),"storeHiddenTag",function(e){return n.hiddenTag=e}),L(x(x(n)),"storeInputRef",function(e){return n.tagInput=e}),L(x(x(n)),"storeTagInput",function(e,t){return n.setState({tagInput:e},t)}),L(x(x(n)),"unselect",function(e){n.state.selectedTag&&n.hiddenTag!==e.relatedTarget&&n.setState({selectedTag:""})}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&q(e,t)}(t,o["Component"]),function(e,t,n){t&&D(e.prototype,t),n&&D(e,n)}(t,[{key:"componentDidMount",value:function(){this.props.storeFocusTagField(this.focusTagField),this.props.storeHasFocus(this.hasFocus),document.addEventListener("click",this.unselect,!0)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.unselect,!0)}},{key:"componentDidUpdate",value:function(){this.hasSelection()&&this.hiddenTag.focus()}},{key:"render",value:function(){var e=this,t=this.props,n=t.allTags,o=t.tags,a=this.state,i=a.selectedTag,s=a.showEmailTooltip,c=a.tagInput;return r.a.createElement("div",{className:"tag-field theme-color-border"},r.a.createElement("div",{className:b()("tag-editor",{"has-selection":this.hasSelection()}),tabIndex:"-1",onKeyDown:this.onKeyDown},r.a.createElement("input",{className:"hidden-tag",tabIndex:"-1",ref:this.storeHiddenTag}),o.filter(Object(m.negate)(l.a)).map(function(t){return r.a.createElement(y,{key:t,tag:t,selected:t===i,onSelect:e.selectTag})}),r.a.createElement(R,{allTags:n,inputRef:this.storeInputRef,value:c,onChange:this.storeTagInput,onSelect:this.addTag,storeFocusInput:this.storeFocusInput,storeHasFocus:this.storeHasFocus,tagNames:Object(m.differenceBy)(n,o,function(e){return e.toLocaleLowerCase()})}),r.a.createElement(u.Overlay,{container:this,onHide:this.hideEmailTooltip,placement:"top",rootClose:!0,shouldUpdatePosition:!0,show:s,target:this.tagInput},r.a.createElement(h,{note:this.props.note}))))}}]),t}();L(A,"displayName","TagField"),L(A,"propTypes",{allTags:i.a.array.isRequired,note:i.a.object.isRequired,storeFocusTagField:i.a.func,storeHasFocus:i.a.func,tags:i.a.array.isRequired,unusedTags:i.a.arrayOf(i.a.string),usedTags:i.a.arrayOf(i.a.string),onUpdateNoteTags:i.a.func.isRequired}),L(A,"defaultProps",{storeFocusTagField:m.noop,storeHasFocus:m.noop,tags:[]});var K=A,U=n(62),W=n(1052),z=n(36),B=n(963),V=n.n(B),J=function(e){var t=e.children,n=e.className;return r.a.createElement("span",{className:n},t)};J.propTypes={className:i.a.string.isRequired};var G=J;function Q(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],o=!0,r=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(o=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);o=!0);}catch(e){r=!0,a=e}finally{try{o||null==s.return||s.return()}finally{if(r)throw a}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var X=function(e){return function(t,n){var o=t.getText();e&&o&&function(e,t){for(var n,o=[];null!==(n=t.exec(e));)o.push([n.index,t.lastIndex]);return o}(o,e).forEach(function(e){return function(t){var n=Q(t,2),o=n[0],r=n[1];return e(o,r,{className:"search-match"})}}(n))}},Y=function(e){return e?new V.a(X(e),G):null};function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function $(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ee(e){return(ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function te(e,t){return(te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ne(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oe(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function re(e){return e.getCurrentContent().getPlainText("\n")}function ae(e){var t=e.getSelection().getFocusKey();return e.getCurrentContent().getBlockForKey(t)}var ie=function(e){return Object(m.includes)(["-","*","+"],e.trim())};var se=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return oe(ne(ne(n=function(e,t){return!t||"object"!==Z(t)&&"function"!=typeof t?ne(e):t}(this,(e=ee(t)).call.apply(e,[this].concat(r))))),"state",{editorState:W.EditorState.createWithContent(W.ContentState.createFromText(n.props.content,"\n"),Object(z.b)(n.props.filter)&&Y(Object(z.c)(n.props.filter)))}),oe(ne(ne(n)),"editorKey",0),oe(ne(ne(n)),"saveEditorRef",function(e){n.editor=e}),oe(ne(ne(n)),"handleEditorStateChange",function(e){if(e!==n.state.editorState){var t=re(e),o=re(n.state.editorState),r=t!==o?function(){return n.props.onChangeContent(t)}:m.noop;n.setState({editorState:e},r)}}),oe(ne(ne(n)),"focus",function(){Object(m.invoke)(ne(ne(n)),"editor.focus")}),oe(ne(ne(n)),"hasFocus",function(){return document.activeElement===Object(m.get)(n.editor,"editor")}),oe(ne(ne(n)),"onTab",function(e){var t=n.state.editorState;e.preventDefault(),!t.getSelection().isCollapsed()&&e.shiftKey||e.altKey||e.ctrlKey||e.metaKey||n.handleEditorStateChange(e.shiftKey?function(e){var t=e.getSelection(),n=t.getStartOffset(),o=ae(e).getText(),r=ie(o),a=r?0:n-1,i=r?1:n;if("\t"!==o.slice(a,i))return e;var s=W.EditorState.push(e,W.Modifier.removeRange(e.getCurrentContent(),t.merge({anchorOffset:a,focusOffset:i})),"remove-range");return W.EditorState.forceSelection(s,t.merge({anchorOffset:n-1,focusOffset:n-1}))}(t):function(e){var t=e.getSelection(),n=t.getStartOffset(),o=ae(e).getText(),r=ie(o)?0:n,a=W.EditorState.push(e,W.Modifier.replaceText(e.getCurrentContent(),t.isCollapsed()?t.merge({anchorOffset:r,focusOffset:r}):t,"\t"),"insert-characters");return W.EditorState.forceSelection(a,a.getSelection().merge({anchorOffset:n+1,focusOffset:n+1}))}(t))}),oe(ne(ne(n)),"handleReturn",function(){var e=n.state.editorState,t=ae(e).getText();if(ie(t))return n.handleEditorStateChange(function(e){var t=W.EditorState.push(e,W.Modifier.removeRange(e.getCurrentContent(),e.getSelection().merge({anchorOffset:0,focusOffset:ae(e).getLength()})),"remove-range");return W.EditorState.forceSelection(t,t.getCurrentContent().getSelectionAfter())}(e)),"handled";var o=t.match(/^[ \t\u2000-\u200a]*[-*+]\s/);return o?(n.handleEditorStateChange(function(e,t){var n=W.EditorState.push(e,W.Modifier.splitBlock(e.getCurrentContent(),e.getSelection()),"split-block"),o=W.EditorState.push(n,W.Modifier.insertText(n.getCurrentContent(),n.getCurrentContent().getSelectionAfter(),t[0]),"insert-characters");return W.EditorState.forceSelection(o,o.getCurrentContent().getSelectionAfter())}(e,o)),"handled"):"not-handled"}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&te(e,t)}(t,o["Component"]),function(e,t,n){t&&$(e.prototype,t),n&&$(e,n)}(t,[{key:"componentDidMount",value:function(){this.props.storeFocusEditor(this.focus),this.props.storeHasFocus(this.hasFocus)}},{key:"componentDidUpdate",value:function(e){e.spellCheckEnabled!==this.props.spellCheckEnabled&&(this.editorKey+=1,this.forceUpdate())}},{key:"componentWillReceiveProps",value:function(e){var t=e.content,n=e.filter,o=this.props.filter,r=this.state.editorState;if(t!==re(r)||n!==o){var a=W.EditorState.createWithContent(W.ContentState.createFromText(t,"\n"),Object(z.b)(n)&&Y(Object(z.c)(n)));r.getSelection().getHasFocus()&&(a=W.EditorState.moveFocusToEnd(a)),this.setState({editorState:a})}}},{key:"render",value:function(){return r.a.createElement(W.Editor,{key:this.editorKey,ref:this.saveEditorRef,spellCheck:this.props.spellCheckEnabled,stripPastedStyles:!0,onChange:this.handleEditorStateChange,editorState:this.state.editorState,onTab:this.onTab,handleReturn:this.handleReturn})}}]),t}();oe(se,"propTypes",{content:i.a.string.isRequired,filter:i.a.string.isRequired,onChangeContent:i.a.func.isRequired,spellCheckEnabled:i.a.bool.isRequired,storeFocusEditor:i.a.func,storeHasFocus:i.a.func}),oe(se,"defaultProps",{storeFocusEditor:m.noop,storeHasFocus:m.noop});var ce=n(166),ue=n(962),le=n.n(ue),fe=n(961),pe=n.n(fe),de=function(e){return n.e(7).then(function(){var e=n(1140);return"object"==typeof e&&e&&e.__esModule?e:Object.assign({},"object"==typeof e&&e,{default:e})}).then(function(t){var n=new t.default.Converter;return n.setFlavor("github"),function(e){for(var t=(new DOMParser).parseFromString(e,"text/html"),n=t.createTreeWalker(t.body),o=[],r=[],a=function(){var e=n.currentNode;if(function(e){switch(e.nodeName.toLowerCase()){case"head":case"html":case"iframe":case"link":case"meta":case"object":case"script":case"style":return!0;default:return!1}}(e))return r.push(e),"continue";if(!function(e){var t=e.nodeName.toLowerCase();if("input"===t)return"checkbox"===e.getAttribute("type");switch(t){case"#text":case"a":case"article":case"b":case"br":case"blockquote":case"cite":case"code":case"dd":case"del":case"div":case"dt":case"em":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":case"hr":case"i":case"img":case"ins":case"kbd":case"li":case"ol":case"p":case"pre":case"s":case"span":case"strong":case"sub":case"sup":case"table":case"tbody":case"td":case"th":case"thead":case"tr":case"tt":case"ul":return!0;default:return!1}}(e))return o.push(e),"continue";var t=e.nodeName.toLowerCase();Object(m.filter)(e.attributes,function(e){var n=e.name,o=e.value;return!(function(e,t,n){switch(e){case"a":switch(t){case"href":return!n.toLowerCase().trim().startsWith("javascript");case"alt":case"rel":case"title":return!0;default:return!1}case"img":switch(t){case"alt":case"src":case"title":return!0;default:return!1}case"input":switch(t){case"disabled":case"checked":case"type":return!0;default:return!1}case"li":switch(t){case"class":switch(n){case"task-list-item":return!0;default:return!1}default:return!1}default:return!1}}(t,n,o)||("href"===n||"src"===n)&&pe.a.isWebUri(o)||"href"===n&&o.startsWith("mailto:")&&le.a.validate(o.slice(7)))}).forEach(function(t){var n=t.name;return e.removeAttribute(n)});var a="a"===t&&e.getAttribute("href");"a"!==t||"string"!=typeof a||a.startsWith("mailto:")||(e.setAttribute("target","_blank"),e.setAttribute("rel","external noopener noreferrer")),"li"===t&&"task-list-item"===e.getAttribute("class")&&e.setAttribute("style","list-style: none;")};n.nextNode();)a();return r.forEach(function(e){try{e.parentNode.removeChild(e)}catch(e){}}),o.forEach(function(e){var t,n=e.parentNode;try{for(;t=e.firstChild;)n.insertBefore(t,e);n.removeChild(e)}catch(e){}}),t.body.innerHTML}(n.makeHtml(e))})},he=function(e,t){de(t).then(function(t){return e.innerHTML=t,e.querySelectorAll("pre code")}).then(function(e){if(e.length)return n.e(8).then(function(){var e=n(1139);return"object"==typeof e&&e&&e.__esModule?e:Object.assign({},"object"==typeof e&&e,{default:e})}).then(function(t){var n=t.default;e.forEach(n.highlightBlock)}).catch(console.log)})};function ge(e){return(ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function be(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function me(e){return(me=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ve(e,t){return(ve=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ye(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function we(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ee=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return we(ye(ye(n=function(e,t){return!t||"object"!==ge(t)&&"function"!=typeof t?ye(e):t}(this,(e=me(t)).call.apply(e,[this].concat(r))))),"focusEditor",function(){return n.focusContentEditor&&n.focusContentEditor()}),we(ye(ye(n)),"saveEditorRef",function(e){return n.editor=e}),we(ye(ye(n)),"isValidNote",function(e){return e&&e.id}),we(ye(ye(n)),"copyRenderedNote",function(e){var t=n.props,o=t.previewingMarkdown,r=t.showNoteInfo,a=t.dialogs;if(!o)return!0;if(r||a.length>0)return!0;if(!document.getSelection().isCollapsed)return!0;var i=document.createDocumentFragment(),s=document.createElement("div");he(s,n.props.note.data.content),i.appendChild(s),e.clipboardData.setData("text/plain",s.innerHTML),e.preventDefault()}),we(ye(ye(n)),"hasFocus",function(){return n.editorHasFocus&&n.editorHasFocus()}),we(ye(ye(n)),"onPreviewClick",function(e){for(var t=e.target;null!==t;t=t.parentNode)if("A"===t.tagName){e.preventDefault(),Object(U.a)(t.href);break}}),we(ye(ye(n)),"saveNote",function(e){var t=n.props.note;n.isValidNote(t)&&(n.props.onChangeContent(t,e),H.a.tracks.recordEvent("editor_note_edited"))}),we(ye(ye(n)),"storeEditorHasFocus",function(e){return n.editorHasFocus=e}),we(ye(ye(n)),"storeFocusContentEditor",function(e){return n.focusContentEditor=e}),we(ye(ye(n)),"storePreview",function(e){return n.previewNode=e}),we(ye(ye(n)),"updateMarkdown",function(){n.previewNode&&he(n.previewNode,n.props.note.data.content)}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ve(e,t)}(t,o["Component"]),function(e,t,n){t&&be(e.prototype,t),n&&be(e,n)}(t,[{key:"componentWillMount",value:function(){this.queueNoteSave=Object(m.debounce)(this.saveNote,2e3),document.addEventListener("copy",this.copyRenderedNote,!1)}},{key:"componentDidMount",value:function(){var e=this.props.previewingMarkdown;this.props.storeFocusEditor(this.focusEditor),this.props.storeHasFocus(this.hasFocus),window.addEventListener("beforeunload",this.queueNoteSave.flush),e&&this.updateMarkdown()}},{key:"componentWillReceiveProps",value:function(){this.queueNoteSave.flush()}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.filter,o=t.note,r=t.onNotePrinted,a=t.previewingMarkdown,i=t.shouldPrint,s=Object(m.get)(o,"data.content","");i&&(window.print(),r()),this.isValidNote(o)&&""===s&&""===n&&Object(m.invoke)(this,"editor.focus");var c=Object(m.get)(e,"note.data.content",""),u=Object(m.get)(this.props,"note.data.content","");(a&&(e.note!==o||c!==u)||!e.previewingMarkdown&&this.props.previewingMarkdown)&&this.updateMarkdown()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("beforeunload",this.queueNoteSave.flush),document.removeEventListener("copy",this.copyRenderedNote,!1)}},{key:"render",value:function(){var e=this.props,t=e.note,n=e.filter,o=e.fontSize,a=e.isViewingRevisions,i=e.previewingMarkdown,s=e.spellCheckEnabled,c=Object(m.get)(this.props,"note.data.content",""),u={fontSize:"".concat(o,"px")},l=b()("note-detail",{"is-viewing-revisions":a});return r.a.createElement("div",{className:"note-detail-wrapper theme-color-border"},t?r.a.createElement("div",{className:l},i&&r.a.createElement("div",{ref:this.storePreview,className:"note-detail-markdown theme-color-bg theme-color-fg",onClick:this.onPreviewClick,style:u}),!i&&r.a.createElement("div",{className:"note-detail-textarea theme-color-bg theme-color-fg",style:u},r.a.createElement(se,{ref:this.saveEditorRef,spellCheckEnabled:s,storeFocusEditor:this.storeFocusContentEditor,storeHasFocus:this.storeEditorHasFocus,content:c,filter:n,onChangeContent:this.queueNoteSave}))):r.a.createElement("div",{className:"note-detail-placeholder"},r.a.createElement(ce.a,null)))}}]),t}();we(Ee,"displayName","NoteDetail"),we(Ee,"propTypes",{dialogs:i.a.array.isRequired,filter:i.a.string.isRequired,fontSize:i.a.number,isViewingRevisions:i.a.bool.isRequired,onChangeContent:i.a.func.isRequired,onNotePrinted:i.a.func.isRequired,note:i.a.object,previewingMarkdown:i.a.bool,shouldPrint:i.a.bool.isRequired,showNoteInfo:i.a.bool.isRequired,spellCheckEnabled:i.a.bool.isRequired,storeFocusEditor:i.a.func,storeHasFocus:i.a.func}),we(Ee,"defaultProps",{storeFocusEditor:m.noop,storeHasFocus:m.noop});var Se=c.a.actionCreators.setShouldPrintNote,Ce=Object(s.b)(function(e){var t=e.appState,n=e.settings;return{dialogs:t.dialogs,filter:t.filter,isViewingRevisions:t.isViewingRevisions,shouldPrint:t.shouldPrint,showNoteInfo:t.showNoteInfo,spellCheckEnabled:n.spellCheckEnabled}},function(e){return{onNotePrinted:function(){return e(Se({shouldPrint:!1}))}}})(Ee);function Oe(e){return(Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Te(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Fe(e){return(Fe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ke(e,t){return(ke=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function je(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"NoteEditor",function(){return Pe});var Pe=function(e){function t(){var e,n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);for(var o=arguments.length,r=new Array(o),a=0;a<o;a++)r[a]=arguments[a];return Ne(je(je(n=function(e,t){return!t||"object"!==Oe(t)&&"function"!=typeof t?je(e):t}(this,(e=Fe(t)).call.apply(e,[this].concat(r))))),"handleShortcut",function(e){var t=e.ctrlKey,o=e.key,r=e.metaKey,a=t||r;if(a&&"P"===o&&n.props.markdownEnabled){var i="edit"===n.props.editorMode?"markdown":"edit";return n.props.setEditorMode({mode:i}),e.stopPropagation(),e.preventDefault(),!1}if(a&&"N"===o)return n.props.closeNote(),e.stopPropagation(),e.preventDefault(),!1;if(a&&"t"===o&&n.props.isEditorActive){if(!n.editFieldHasFocus())return n.focusNoteEditor&&n.focusNoteEditor(),e.stopPropagation(),e.preventDefault(),!1;if(!n.tagFieldHasFocus())return n.focusTagField&&n.focusTagField(),e.stopPropagation(),e.preventDefault(),!1}return!0}),Ne(je(je(n)),"editFieldHasFocus",function(){return n.editorHasFocus&&n.editorHasFocus()}),Ne(je(je(n)),"storeEditorHasFocus",function(e){return n.editorHasFocus=e}),Ne(je(je(n)),"storeFocusEditor",function(e){return n.focusNoteEditor=e}),Ne(je(je(n)),"storeFocusTagField",function(e){return n.focusTagField=e}),Ne(je(je(n)),"storeTagFieldHasFocus",function(e){return n.tagFieldHasFocus=e}),Ne(je(je(n)),"tagFieldHasFocus",function(){return n.tagFieldHasFocus&&n.tagFieldHasFocus()}),Ne(je(je(n)),"toggleShortcuts",function(e){e?window.addEventListener("keydown",n.handleShortcut,!0):window.removeEventListener("keydown",n.handleShortcut,!0)}),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ke(e,t)}(t,o["Component"]),function(e,t,n){t&&Te(e.prototype,t),n&&Te(e,n)}(t,[{key:"componentDidMount",value:function(){this.toggleShortcuts(!0)}},{key:"componentWillUnmount",value:function(){this.toggleShortcuts(!1)}},{key:"render",value:function(){var e=this.props,t=e.editorMode,n=e.note,o=e.fontSize,a=this.props.revision||n,i=a&&a.data&&a.data.tags||[],s=!(!n||!n.data.deleted),c=a&&a.data&&a.data.systemTags&&-1!==a.data.systemTags.indexOf("markdown");return r.a.createElement("div",{className:"note-editor theme-color-bg theme-color-fg"},r.a.createElement(Ce,{storeFocusEditor:this.storeFocusEditor,storeHasFocus:this.storeEditorHasFocus,filter:this.props.filter,note:a,previewingMarkdown:c&&"markdown"===t,onChangeContent:this.props.onUpdateContent,fontSize:o}),n&&!s&&r.a.createElement(K,{storeFocusTagField:this.storeFocusTagField,storeHasFocus:this.storeTagFieldHasFocus,allTags:this.props.allTags.map(Object(m.property)("data.name")),note:this.props.note,tags:i,onUpdateNoteTags:this.props.onUpdateNoteTags.bind(null,n)}))}}]),t}();Ne(Pe,"displayName","NoteEditor"),Ne(Pe,"propTypes",{allTags:i.a.array.isRequired,closeNote:i.a.func.isRequired,editorMode:i.a.oneOf(["edit","markdown"]),isEditorActive:i.a.bool.isRequired,filter:i.a.string.isRequired,markdownEnabled:i.a.bool.isRequired,note:i.a.object,fontSize:i.a.number,onUpdateContent:i.a.func.isRequired,onUpdateNoteTags:i.a.func.isRequired,revision:i.a.object,setEditorMode:i.a.func.isRequired}),Ne(Pe,"defaultProps",{editorMode:"edit",note:{data:{tags:[]}}});var Re=c.a.actionCreators,_e=Re.closeNote,He=Re.setEditorMode;t.default=Object(s.b)(function(e){var t=e.appState,n=e.settings;return{allTags:t.tags,filter:t.filter,fontSize:n.fontSize,editorMode:t.editorMode,isEditorActive:!t.showNavigation,markdownEnabled:n.markdownEnabled,revision:t.revision}},function(e){return{closeNote:function(){return e(_e())},setEditorMode:function(t){return e(He(t))}}})(Pe)}}]);